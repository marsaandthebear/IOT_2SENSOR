#include <WiFi.h>
#include "DHT.h"

// WiFi Credential
const char* ssid = "GEDUNG B - WPA";
const char* password = "123123123";

// Pin Sensor DHT22
#define DHTPIN 25
#define DHTTYPE DHT22
DHT dht(DHTPIN, DHTTYPE);

// Pin Sensor Cahaya / Flame
#define FLAME_PIN 26  // Pin Digital Output

void setup() {
  Serial.begin(115200);
  delay(500);

  Serial.println("Memulai Sistem IoT ESP32...");
  dht.begin();

  pinMode(FLAME_PIN, INPUT);
  Serial.println("Sensor DHT22 & Sensor Cahaya siap!");

  WiFi.begin(ssid, password);
  Serial.println("Menghubungkan ke WiFi...");

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("\nWiFi Terhubung!");
  Serial.print("IP Address ESP32: ");
  Serial.println(WiFi.localIP());
}

void loop() {
  // Baca Sensor DHT22
  float humidity = dht.readHumidity();
  float temperature = dht.readTemperature();

  // Validasi data DHT22
  if (isnan(humidity) || isnan(temperature)) {
    Serial.println("Gagal membaca data DHT22!");
  } else {
    Serial.print("Suhu: ");
    Serial.print(temperature);
    Serial.print("°C | Kelembapan: ");
    Serial.print(humidity);
    Serial.println("%");
  }

  // Baca Sensor Cahaya/Flame
  int flameState = digitalRead(FLAME_PIN);
  if (flameState == LOW) {
    Serial.println("⚠️  Ada Cahaya Kuat / Api Terdeteksi!");
  } else {
    Serial.println("✔️  Tidak ada api / intensitas cahaya rendah.");
  }

  Serial.println("---------------------------");
  delay(2000);
}
